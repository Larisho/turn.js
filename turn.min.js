/* turn.js r3 | turnjs.com/license.txt | revision by r4venw */
(function(a){'use strict';let b,d="",e=Math.PI,c=e/2,f=("ontouchstart"in window),g=f?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},h={backward:["bl","tl"],forward:["br","tr"],all:["tl","bl","tr","br"]},i=["single","double"],j={page:1,gradients:!0,duration:600,acceleration:!0,display:"double",when:null},k={folding:null,corners:"forward",cornerSize:100,gradients:!0,duration:600,acceleration:!0},l={0:{top:0,left:0,right:"auto",bottom:"auto"},1:{top:0,right:0,left:"auto",bottom:"auto"}},m=function(a,b,c,d){return{css:{position:"absolute",top:a,left:b,overflow:d||"hidden","z-index":c||"auto"}}},n=function(a,b,c,d,e){const f=1-e,g=f*f*f,h=e*e*e;return q(Math.round(g*a.x+3*e*f*f*b.x+3*e*e*f*c.x+h*d.x),Math.round(g*a.y+3*e*f*f*b.y+3*e*e*f*c.y+h*d.y))},p=function(a){return 180*(a/e)},q=function(a,b){return{x:a,y:b}},r=function(a,c,d){return b&&d?" translate3d("+a+"px,"+c+"px, 0px) ":" translate("+a+"px, "+c+"px) "},s=function(a){return" rotate("+a+"deg) "},t=function(a,b){return Object.prototype.hasOwnProperty.call(b,a)},u=function(){const a=["Moz","Webkit","Khtml","O","ms"];let b=a.length,c="";for(;b--;)a[b]+"Transform"in document.body.style&&(c="-"+a[b].toLowerCase()+"-");return c},w=function(a,b,e,c,f){let g;const h=[];if("-webkit-"==d){for(g=0;g<f;g++)h.push("color-stop("+c[g][0]+", "+c[g][1]+")");a.css({"background-image":"-webkit-gradient(linear, "+b.x+"% "+b.y+"%,  "+e.x+"% "+e.y+"%, "+h.join(",")+" )"})}else{b={x:b.x/100*a.width(),y:b.y/100*a.height()},e={x:e.x/100*a.width(),y:e.y/100*a.height()};const i=e.x-b.x,j=e.y-b.y,k=Math.atan2(j,i),l=k-Math.PI/2,m=Math.abs(a.width()*Math.sin(l))+Math.abs(a.height()*Math.cos(l)),n=Math.sqrt(j*j+i*i),o=q(e.x<b.x?a.width():0,e.y<b.y?a.height():0),p=Math.tan(k),r=-1/p,s=(r*o.x-o.y-p*b.x+b.y)/(r-p),t={x:s,y:r*s-r*o.x+o.y},u=Math.sqrt(Math.pow(t.x-b.x,2)+Math.pow(t.y-b.y,2));for(g=0;g<f;g++)h.push(" "+c[g][1]+" "+100*(u+n*c[g][0])/m+"%");a.css({"background-image":d+"linear-gradient("+-k+"rad,"+h.join(",")+")"})}},x={init:function(c){void 0===b&&(b="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,d=u());const k=this.data(),l=this.children();if(c=a.extend({width:this.width(),height:this.height()},j,c),k.opts=c,k.pageObjs={},k.pages={},k.pageWrap={},k.pagePlace={},k.pageMv=[],k.totalPages=c.pages||0,c.when)for(var e in c.when)t(e,c.when)&&this.bind(e,c.when[e]);for(this.css({position:"relative",width:c.width,height:c.height}),this.turn("display",c.display),b&&!f&&c.acceleration&&this.transform(r(0,0,!0)),e=0;e<l.length;e++)this.turn("addPage",l[e],e+1);return this.turn("page",c.page),h=a.extend({},h,c.corners),a(this).bind(g.start,function(a){for(let b in k.pages)if(t(b,k.pages)&&!1===y._eventStart.call(k.pages[b],a))return!1}),a(document).bind(g.move,function(a){for(let b in k.pages)t(b,k.pages)&&y._eventMove.call(k.pages[b],a)}).bind(g.end,function(a){for(let b in k.pages)t(b,k.pages)&&y._eventEnd.call(k.pages[b],a)}),k.done=!0,this},destroy:function(){let b=this.data();b.destroying=!0,a.each(["end","first","flip","last","pressed","released","start","turning","turned","zooming","missing"],function(d,b){a(this).unbind(b)}),this.parent().unbind("start");for(let c=b.totalPages;0<c;c--){a(document).unbind(g.move).unbind(g.up);try{this.turn("removePage",c)}catch(a){}}for(a(document).unbind(g.move).unbind(g.up);0!==b.totalPages;)this.turn("removePage",b.totalPages);return b.fparent&&b.fparent.remove(),b.shadow&&b.shadow.remove(),this.removeData(),b=null,this},addPage:function(b,c){let d=!1;const e=this.data(),f=e.totalPages+1;if(!c)c=f,d=!0;else if(c==f)c=f,d=!0;else if(c>f)throw new Error("It is impossible to add the page \""+c+"\", the maximum value is: \""+f+"\"");return 1<=c&&c<=f&&(e.done&&this.turn("stop"),c in e.pageObjs&&x._movePages.call(this,c,1),d&&(e.totalPages=f),e.pageObjs[c]=a(b).addClass("turn-page p"+c),x._addPage.call(this,c),e.done&&this.turn("update"),x._removeFromDOM.call(this)),this},_addPage:function(b){const c=this.data(),d=c.pageObjs[b];if(d)if(x._necessPage.call(this,b)){if(!c.pageWrap[b]){const e="double"==c.display?this.width()/2:this.width(),f=this.height();d.css({width:e,height:f}),c.pagePlace[b]=b,c.pageWrap[b]=a("<div/>",{class:"turn-page-wrapper",page:b,css:{position:"absolute",overflow:"hidden",width:e,height:f}}).css(l["double"==c.display?b%2:0]),this.append(c.pageWrap[b]),c.pageWrap[b].prepend(c.pageObjs[b])}b&&1!=x._setPageLoc.call(this,b)||x._makeFlip.call(this,b)}else c.pagePlace[b]=0,c.pageObjs[b]&&c.pageObjs[b].remove()},hasPage:function(a){return a in this.data().pageObjs},_makeFlip:function(a){const b=this.data();if(!b.pages[a]&&b.pagePlace[a]==a){const c="single"==b.display,d=a%2;b.pages[a]=b.pageObjs[a].css({width:c?this.width():this.width()/2,height:this.height()}).flip({page:a,next:c&&a===b.totalPages?a-1:d||c?a+1:a-1,turn:this,duration:b.opts.duration,acceleration:b.opts.acceleration,corners:c?"all":d?"forward":"backward",backGradient:b.opts.gradients,frontGradient:b.opts.gradients}).flip("disable",b.disabled).bind("pressed",x._pressed).bind("released",x._released).bind("start",x._start).bind("end",x._end).bind("flip",x._flip)}return b.pages[a]},_makeRange:function(){let a;const b=this.data(),c=this.turn("range");for(a=c[0];a<=c[1];a++)x._addPage.call(this,a)},range:function(a){let b,c,d;const e=this.data();a=a||e.tpage||e.page||1;const f=x._view.call(this,a);if(1>a||a>e.totalPages)throw new Error("\""+a+"\" is not a page for range");return f[1]=f[1]||f[0],1<=f[0]&&f[1]<=e.totalPages?(b=Math.floor(2),e.totalPages-f[1]>f[0]?(c=Math.min(f[0]-1,b),d=2*b-c):(d=Math.min(e.totalPages-f[1],b),c=2*b-d)):(c=5,d=5),[Math.max(1,f[0]-c),Math.min(e.totalPages,f[1]+d)]},_necessPage:function(a){if(0===a)return!0;const b=this.turn("range");return a>=b[0]&&a<=b[1]},_removeFromDOM:function(){const a=this.data();for(var b in a.pageWrap)t(b,a.pageWrap)&&!x._necessPage.call(this,b)&&x._removePageFromDOM.call(this,b)},_removePageFromDOM:function(a){const b=this.data();if(b.pages[a]){const c=b.pages[a].data();c.f&&c.f.fwrapper&&c.f.fwrapper.remove(),b.pages[a].remove(),delete b.pages[a]}b.pageObjs[a]&&b.pageObjs[a].remove(),b.pageWrap[a]&&(b.pageWrap[a].remove(),delete b.pageWrap[a]),delete b.pagePlace[a]},removePage:function(a){const b=this.data();return b.pageObjs[a]&&(this.turn("stop"),x._removePageFromDOM.call(this,a),delete b.pageObjs[a],x._movePages.call(this,a,-1),--b.totalPages,x._makeRange.call(this),b.page>b.totalPages&&this.turn("page",b.totalPages)),this},_movePages:function(a,b){let c;const d=this.data(),e="single"==d.display,f=function(a){const c=a+b,f=c%2;d.pageObjs[a]&&(d.pageObjs[c]=d.pageObjs[a].removeClass("page"+a).addClass("page"+c)),d.pagePlace[a]&&d.pageWrap[a]&&(d.pagePlace[c]=c,d.pageWrap[c]=d.pageWrap[a].css(l[e?0:f]).attr("page",c),d.pages[a]&&(d.pages[c]=d.pages[a].flip("options",{page:c,next:e||f?c+1:c-1,corners:e?"all":f?"forward":"backward"})),b&&(delete d.pages[a],delete d.pagePlace[a],delete d.pageObjs[a],delete d.pageWrap[a],delete d.pageObjs[a]))};if(0<b)for(c=d.totalPages;c>=a;c--)f(c);else for(c=a;c<=d.totalPages;c++)f(c)},display:function(b){const c=this.data(),d=c.display;if(b){if(-1==a.inArray(b,i))throw new Error("\""+b+"\" is not a value for display");if("single"==b?!c.pageObjs[0]&&(this.turn("stop").css({overflow:"hidden"}),c.pageObjs[0]=a("<div />",{class:"turn-page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)):c.pageObjs[0]&&(this.turn("stop").css({overflow:""}),c.pageObjs[0].remove(),delete c.pageObjs[0]),c.display=b,d){const a=this.turn("size");x._movePages.call(this,1,0),this.turn("size",a.width,a.height).turn("update")}return this}return d},animating:function(){return 0<this.data().pageMv.length},disable:function(b){const c=this.data(),d=this.turn("view");for(var e in c.disabled=void 0===b||!0===b,c.pages)t(e,c.pages)&&c.pages[e].flip("disable",!!b&&a.inArray(e,d));return this},size:function(a,b){if(a&&b){const d=this.data(),e="double"==d.display?a/2:a;for(var c in this.css({width:a,height:b}),d.pageObjs[0]&&d.pageObjs[0].css({width:e,height:b}),d.pageWrap)t(c,d.pageWrap)&&(d.pageObjs[c].css({width:e,height:b}),d.pageWrap[c].css({width:e,height:b}),d.pages[c]&&d.pages[c].css({width:e,height:b}));return this.turn("resize"),this}return{width:this.width(),height:this.height()}},resize:function(){let a;const b=this.data();for(b.pages[0]&&(b.pageWrap[0].css({left:-this.width()}),b.pages[0].flip("resize",!0)),a=1;a<=b.totalPages;a++)b.pages[a]&&b.pages[a].flip("resize",!0)},_removeMv:function(a){let b;const c=this.data();for(b=0;b<c.pageMv.length;b++)if(c.pageMv[b]==a)return c.pageMv.splice(b,1),!0;return!1},_addMv:function(a){const b=this.data();x._removeMv.call(this,a),b.pageMv.push(a)},_view:function(a){const b=this.data();return a=a||b.page,"double"==b.display?a%2?[a-1,a]:[a,a+1]:[a]},view:function(a){const b=this.data(),c=x._view.call(this,a);return"double"==b.display?[0<c[0]?c[0]:0,c[1]<=b.totalPages?c[1]:0]:[0<c[0]&&c[0]<=b.totalPages?c[0]:0]},stop:function(){let a,b;const c=this.data(),d=c.pageMv;for(a in c.pageMv=[],c.tpage&&(c.page=c.tpage,delete c.tpage),d)t(a,d)&&(b=c.pages[d[a]].data().f.opts,y._moveFoldingPage.call(c.pages[d[a]],null),c.pages[d[a]].flip("hideFoldedPage"),c.pagePlace[b.next]=b.next,b.force&&(b.next=0==b.page%2?b.page-1:b.page+1,delete b.force));return this.turn("update"),this},pages:function(a){const b=this.data();if(a){if(a<b.totalPages){for(let c=a+1;c<=b.totalPages;c++)this.turn("removePage",c);this.turn("page")>a&&this.turn("page",a)}return b.totalPages=a,this}return b.totalPages},_fitPage:function(b,c){const d=this.data(),e=this.turn("view",b);d.page!=b&&(this.trigger("turning",[b,e]),-1!=a.inArray(1,e)&&this.trigger("first"),-1!=a.inArray(d.totalPages,e)&&this.trigger("last"));d.pageObjs[b]&&(d.tpage=b,this.turn("stop",c),x._removeFromDOM.call(this),x._makeRange.call(this),this.trigger("turned",[b,e]))},_turnPage:function(b){let c,d;const e=this.data(),f=this.turn("view"),g=this.turn("view",b);if((e.page!=b&&(this.trigger("turning",[b,g]),-1!=a.inArray(1,g)&&this.trigger("first"),-1!=a.inArray(e.totalPages,g)&&this.trigger("last")),!!e.pageObjs[b])&&(e.tpage=b,this.turn("stop"),x._makeRange.call(this),"single"==e.display?(c=f[0],d=g[0]):f[1]&&b>f[1]?(c=f[1],d=g[0]):f[0]&&b<f[0]&&(c=f[0],d=g[1]),e.pages[c])){const a=e.pages[c].data().f.opts;e.tpage=d,a.next!=d&&(a.next=d,e.pagePlace[d]=a.page,a.force=!0),"single"==e.display?e.pages[c].flip("turnPage",g[0]>f[0]?"br":"bl"):e.pages[c].flip("turnPage")}},page:function(b){b=parseInt(b,10);const c=this.data();return 0<b&&b<=c.totalPages?(c.done&&-1==a.inArray(b,this.turn("view"))?x._turnPage.call(this,b):x._fitPage.call(this,b),this):c.page},next:function(){const a=this.data();return this.turn("page",x._view.call(this,a.page).pop()+1)},previous:function(){const a=this.data();return this.turn("page",x._view.call(this,a.page).shift()-1)},_addMotionPage:function(){const b=a(this).data().f.opts,c=b.turn,d=c.data();b.pageMv=b.page,x._addMv.call(c,b.pageMv),d.pagePlace[b.next]=b.page,c.turn("update")},_start:function(b,c,d){const e=c.turn.data(),f=a.Event("start");if(b.stopPropagation(),c.turn.trigger(f,[c,d]),f.isDefaultPrevented())return void b.preventDefault();if("single"==e.display){const a="l"==d.charAt(1);1==c.page&&a||c.page==e.totalPages&&!a?b.preventDefault():a?(c.next=c.next<c.page?c.next:c.page-1,c.force=!0):c.next=c.next>c.page?c.next:c.page+1}x._addMotionPage.call(this)},_end:function(b,c){const d=a(this),e=d.data().f,f=e.opts,g=f.turn,h=g.data();b.stopPropagation(),c||h.tpage?(h.tpage==f.next||h.tpage==f.page)&&(delete h.tpage,x._fitPage.call(g,h.tpage||f.next,!0)):(x._removeMv.call(g,f.pageMv),g.turn("update"))},_pressed:function(){const b=a(this),c=b.data().f,d=c.opts.turn,e=d.data().pages;for(var f in e)f!=c.opts.page&&e[f].flip("disable",!0);return c.time=new Date().getTime()},_released:function(b,c){const d=a(this),e=d.data().f;b.stopPropagation(),(200>new Date().getTime()-e.time||0>c.x||c.x>a(this).width())&&(b.preventDefault(),e.opts.turn.data().tpage=e.opts.next,e.opts.turn.turn("update"),a(d).flip("turnPage"))},_flip:function(){const b=a(this).data().f.opts;b.turn.trigger("turn",[b.next])},calculateZ:function(a){let b,c,d,e,f;const g=this,h=this.data(),j=this.turn("view"),k=j[0]||j[1],l={pageZ:{},partZ:{},pageV:{}},m=function(a){const b=g.turn("view",a);b[0]&&(l.pageV[b[0]]=!0),b[1]&&(l.pageV[b[1]]=!0)};for(b=0;b<a.length;b++)c=a[b],d=h.pages[c].data().f.opts.next,e=h.pagePlace[c],m(c),m(d),f=h.pagePlace[d]==d?d:c,l.pageZ[f]=h.totalPages-Math.abs(k-f),l.partZ[e]=2*h.totalPages+Math.abs(k-f);return l},update:function(){const a=this.data();if(a.pageMv.length&&0!==a.pageMv[0]){let c;const d=this.turn("calculateZ",a.pageMv),e=this.turn("view",a.tpage);for(var b in a.pagePlace[e[0]]==e[0]?c=e[0]:a.pagePlace[e[1]]==e[1]&&(c=e[1]),a.pageWrap)t(b,a.pageWrap)&&(a.pageWrap[b].css({display:d.pageV[b]?"":"none","z-index":d.pageZ[b]||0}),a.pages[b]&&(a.pages[b].flip("z",d.partZ[b]||null),d.pageV[b]&&a.pages[b].flip("resize"),a.tpage&&a.pages[b].flip("disable",!0)))}else for(b in a.pageWrap){if(!t(b,a.pageWrap))continue;const c=x._setPageLoc.call(this,b);a.pages[b]&&a.pages[b].flip("disable",a.disabled||1!=c).flip("z",null)}},_setPageLoc:function(a){const b=this.data(),c=this.turn("view");return a==c[0]||a==c[1]?(b.pageWrap[a].css({"z-index":b.totalPages,display:""}),1):"single"==b.display&&a==c[0]+1||"double"==b.display&&a==c[0]-2||a==c[1]+2?(b.pageWrap[a].css({"z-index":b.totalPages-1,display:""}),2):(b.pageWrap[a].css({"z-index":0,display:"none"}),0)}},y={init:function(a){return a.gradients&&(a.frontGradient=!0,a.backGradient=!0),this.data({f:{}}),this.flip("options",a),y._addPageWrapper.call(this),this},setData:function(b){const c=this.data();return c.f=a.extend(c.f,b),this},options:function(b){const c=this.data().f;return b?(y.setData.call(this,{opts:a.extend({},c.opts||k,b)}),this):c.opts},z:function(a){const b=this.data().f;return b.opts["z-index"]=a,b.fwrapper.css({"z-index":a||parseInt(b.parent.css("z-index"),10)||0}),this},_cAllowed:function(){return h[this.data().f.opts.corners]||this.data().f.opts.corners},_cornerActivated:function(b){if(b.originalEvent===void 0)return!1;b=f?b.originalEvent.touches:[b];const d=this.data().f,g=d.parent.offset(),h=this.width(),i=this.height(),j={x:Math.max(0,b[0].pageX-g.left),y:Math.max(0,b[0].pageY-g.top)},c=d.opts.cornerSize,k=y._cAllowed.call(this);if(0>=j.x||0>=j.y||j.x>=h||j.y>=i)return!1;if(j.y<c)j.corner="t";else if(j.y>=i-c)j.corner="b";else return!1;if(j.x<=c)j.corner+="l";else if(j.x>=h-c)j.corner+="r";else return!1;return-1!=a.inArray(j.corner,k)&&j},_c:function(a,b){return b=b||0,{tl:q(b,b),tr:q(this.width()-b,b),bl:q(b,this.height()-b),br:q(this.width()-b,this.height()-b)}[a]},_c2:function(a){return{tl:q(2*this.width(),0),tr:q(-this.width(),0),bl:q(2*this.width(),this.height()),br:q(-this.width(),this.height())}[a]},_foldingPage:function(){const a=this.data().f.opts;if(a.folding)return a.folding;if(a.turn){const b=a.turn.data();return"single"==b.display?b.pageObjs[a.next]?b.pageObjs[0]:null:b.pageObjs[a.next]}},_backGradient:function(){const b=this.data().f,c=b.opts.turn,d=b.opts.backGradient&&(!c||"single"==c.data().display||2!=b.opts.page&&b.opts.page!=c.data().totalPages-1);return d&&!b.bshadow&&(b.bshadow=a("<div/>",m(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(b.parent)),d},resize:function(a){const b=this.data().f,c=this.width(),d=this.height(),e=Math.round(Math.sqrt(Math.pow(c,2)+Math.pow(d,2)));a&&(b.wrapper.css({width:e,height:e}),b.fwrapper.css({width:e,height:e}).children(":first-child").css({width:c,height:d}),b.fpage.css({width:d,height:c}),b.opts.frontGradient&&b.ashadow.css({width:d,height:c}),y._backGradient.call(this)&&b.bshadow.css({width:c,height:d})),b.parent.is(":visible")&&(b.fwrapper.css({top:b.parent.offset().top,left:b.parent.offset().left}),b.opts.turn&&b.fparent.css({top:-b.opts.turn.offset().top,left:-b.opts.turn.offset().left})),this.flip("z",b.opts["z-index"])},_addPageWrapper:function(){const b=this.data().f,c=this.parent();if(!b.wrapper){const d=this.css("left"),e=this.css("top"),f=this.width(),g=this.height(),h=Math.round(Math.sqrt(Math.pow(f,2)+Math.pow(g,2)));if(b.parent=c,b.fparent=b.opts.turn?b.opts.turn.data().fparent:a("#turn-fwrappers"),!b.fparent){const c=a("<div/>",{css:{"pointer-events":"none"}}).hide();c.data().flips=0,b.opts.turn?(c.css(m(-b.opts.turn.offset().top,-b.opts.turn.offset().left,"auto","visible").css).appendTo(b.opts.turn),b.opts.turn.data().fparent=c):c.css(m(0,0,"auto","visible").css).attr("id","turn-fwrappers").appendTo(a("body")),b.fparent=c}this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"}),b.wrapper=a("<div/>",m(0,0,this.css("z-index"))).appendTo(c).prepend(this),b.fwrapper=a("<div/>",m(c.offset().top,c.offset().left)).hide().appendTo(b.fparent),b.fpage=a("<div/>",{css:{cursor:"default"}}).appendTo(a("<div/>",m(0,0,0,"visible")).appendTo(b.fwrapper)),b.opts.frontGradient&&(b.ashadow=a("<div/>",m(0,0,1)).appendTo(b.fpage)),y.setData.call(this,b),y.resize.call(this,!0)}},_fold:function(b){const d=this;let f,g,i,j,k,l,m=0,n=0,t=q(0,0),u=q(0,0),v=q(0,0);const z=this.width(),A=this.height(),B=y._foldingPage.call(this),C=Math.tan(n),D=this.data().f,E=D.opts.acceleration,F=D.wrapper[0].offsetHeight,h=y._c.call(this,b.corner),o="t"==b.corner.substr(0,1),G="l"==b.corner.substr(1,1),H=function(){const a=q(h.x?h.x-b.x:b.x,h.y?h.y-b.y:b.y),r=Math.atan2(a.y,a.x);let s;n=c-r,m=p(n),s=q(G?z-a.x/2:b.x+a.x/2,a.y/2);const w=n-Math.atan2(s.y,s.x),x=Math.max(0,Math.sin(w)*Math.sqrt(Math.pow(s.x,2)+Math.pow(s.y,2)));if(v=q(x*Math.sin(n),x*Math.cos(n)),n>c&&(v.x+=Math.abs(v.y*Math.tan(r)),v.y=0,Math.round(v.x*Math.tan(e-n))<A))return b.y=Math.sqrt(Math.pow(A,2)+2*s.x*a.x),o&&(b.y=A-b.y),H();if(n>c){const a=e-n,b=F-A/Math.sin(a);t=q(Math.round(b*Math.cos(a)),Math.round(b*Math.sin(a))),G&&(t.x=-t.x),o&&(t.y=-t.y)}f=Math.round(v.y/Math.tan(n)+v.x);const B=z-f,C=B*Math.cos(2*n),E=B*Math.sin(2*n);u=q(Math.round(G?B-C:f+C),Math.round(o?E:A-E)),k=B*Math.sin(n);const I=y._c2.call(d,b.corner),J=Math.sqrt(Math.pow(I.x-b.x,2)+Math.pow(I.y-b.y,2));return l=J<z?J/z:1,D.opts.frontGradient&&(j=100<k?(k-100)/k:0,g=q(100*(k*Math.sin(c-n)/A),100*(k*Math.cos(c-n)/z)),o&&(g.y=100-g.y),G&&(g.x=100-g.x)),y._backGradient.call(d)&&(i=q(100*(k*Math.sin(n)/z),100*(k*Math.cos(n)/A)),!G&&(i.x=100-i.x),!o&&(i.y=100-i.y)),v.x=Math.round(v.x),v.y=Math.round(v.y),!0},I=function(b,e,c,h){const a=["0","auto"],f=(z-F)*c[0]/100,k=(A-F)*c[1]/100,m={left:a[e[0]],top:a[e[1]],right:a[e[2]],bottom:a[e[3]]},p=90!=h&&-90!=h?G?-1:1:0;c=c[0]+"% "+c[1]+"%",d.css(m).transform(s(h)+r(b.x+p,b.y,E),c),D.fpage.parent().css(m),D.wrapper.transform(r(-b.x+f-p,-b.y+k,E)+s(-h),c),D.fwrapper.transform(r(-b.x+t.x+f,-b.y+t.y+k,E)+s(-h),c),D.fpage.parent().transform(s(h)+r(b.x+u.x-t.x,b.y+u.y-t.y,E),c),D.opts.frontGradient&&w(D.ashadow,q(G?100:0,o?100:0),q(g.x,g.y),[[j,"rgba(0,0,0,0)"],[.8*(1-j)+j,"rgba(0,0,0,"+.2*l+")"],[1,"rgba(255,255,255,"+.2*l+")"]],3,n),y._backGradient.call(d)&&w(D.bshadow,q(G?0:100,o?0:100),q(i.x,i.y),[[.8,"rgba(0,0,0,0)"],[1,"rgba(0,0,0,"+.3*l+")"],[1,"rgba(0,0,0,0)"]],3)};switch(b.corner){case"tl":b.x=Math.max(b.x,1),H(),I(v,[1,0,0,1],[100,0],m),D.fpage.transform(r(-A,-z,E)+s(90-2*m),"100% 100%"),B.transform(s(90)+r(0,-A,E),"0% 0%");break;case"tr":b.x=Math.min(b.x,z-1),H(),I(q(-v.x,v.y),[0,0,0,1],[0,0],-m),D.fpage.transform(r(0,-z,E)+s(-90+2*m),"0% 100%"),B.transform(s(270)+r(-z,0,E),"0% 0%");break;case"bl":b.x=Math.max(b.x,1),H(),I(q(v.x,-v.y),[1,1,0,0],[100,100],-m),D.fpage.transform(r(-A,0,E)+s(-90+2*m),"100% 0%"),B.transform(s(270)+r(-z,0,E),"0% 0%");break;case"br":b.x=Math.min(b.x,z-1),H(),I(q(-v.x,-v.y),[0,1,1,0],[0,100],m),D.fpage.transform(s(90-2*m),"0% 0%"),B.transform(s(90)+r(0,-A,E),"0% 0%");}D.point=b},_moveFoldingPage:function(a){const b=this.data().f,c=y._foldingPage.call(this);c&&(a?!b.fpage.children()[b.ashadow?"1":"0"]&&(y.setData.call(this,{backParent:c.parent()}),b.fpage.prepend(c)):b.backParent&&b.backParent.prepend(c))},_showFoldedPage:function(b,c){const d=y._foldingPage.call(this),e=this.data(),f=e.f;if(!f.point||f.point.corner!=b.corner){const c=a.Event("start");if(this.trigger(c,[f.opts,b.corner]),c.isDefaultPrevented())return!1}if(d){if(c){const a=this,c=f.point&&f.point.corner==b.corner?f.point:y._c.call(this,b.corner,1);this.animatef({from:[c.x,c.y],to:[b.x,b.y],duration:500,frame:function(c){b.x=Math.round(c[0]),b.y=Math.round(c[1]),y._fold.call(a,b)}})}else y._fold.call(this,b),e.effect&&!e.effect.turning&&this.animatef(!1);return f.fwrapper.is(":visible")||(f.fparent.show().data().flips++,y._moveFoldingPage.call(this,!0),f.fwrapper.show(),f.bshadow&&f.bshadow.show()),!0}return!1},hide:function(){const a=this.data().f,b=y._foldingPage.call(this);return 0==--a.fparent.data().flips&&a.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform("","0% 100%"),a.wrapper.transform("","0% 100%"),a.fwrapper.hide(),a.bshadow&&a.bshadow.hide(),b.transform("","0% 0%"),this},hideFoldedPage:function(a){const b=this.data().f;if(!b.point)return;const c=this,d=b.point,e=function(){b.point=null,c.flip("hide"),c.trigger("end",[!1])};if(a){const a=y._c.call(this,d.corner),b="t"==d.corner.substr(0,1),f=b?Math.min(0,d.y-a.y)/2:Math.max(0,d.y-a.y)/2,g=q(d.x,d.y+f),h=q(a.x,a.y-f);this.animatef({from:0,to:1,frame:function(b){const e=n(d,g,h,a,b);d.x=e.x,d.y=e.y,y._fold.call(c,d)},complete:e,duration:800,hiding:!0})}else this.animatef(!1),e()},turnPage:function(a){const b=this,c=this.data().f;a={corner:c.corner?c.corner.corner:a||y._cAllowed.call(this)[0]};const d=c.point||y._c.call(this,a.corner,c.opts.turn?c.opts.turn.data().opts.elevation:0),e=y._c2.call(this,a.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(c){const f=n(d,d,e,e,c);a.x=f.x,a.y=f.y,y._showFoldedPage.call(b,a)},complete:function(){b.trigger("end",[!0])},duration:c.opts.duration,turning:!0}),c.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},_eventStart:function(a){const b=this.data().f;if(!b.disabled&&!this.flip("isTurning")){if(b.corner=y._cornerActivated.call(this,a),b.corner&&y._foldingPage.call(this,b.corner))return y._moveFoldingPage.call(this,!0),this.trigger("pressed",[b.point]),!1;b.corner=null}},_eventMove:function(a){const b=this.data().f;if(!b.disabled)if(a=f?a.originalEvent.touches:[a],b.corner){const c=b.parent.offset();b.corner.x=a[0].pageX-c.left,b.corner.y=a[0].pageY-c.top,y._showFoldedPage.call(this,b.corner)}else if(!this.data().effect&&this.is(":visible")){const c=y._cornerActivated.call(this,a[0]);if(c){const a=y._c.call(this,c.corner,b.opts.cornerSize/2);c.x=a.x,c.y=a.y,y._showFoldedPage.call(this,c,!0)}else y.hideFoldedPage.call(this,!0)}},_eventEnd:function(){const b=this.data().f;if(!b.disabled&&b.point){const c=a.Event("released");this.trigger(c,[b.point]),c.isDefaultPrevented()||y.hideFoldedPage.call(this,!0)}b.corner=null},disable:function(a){return y.setData.call(this,{disabled:a}),this}},z=function(a,b,c){if(!c[0]||"object"==typeof c[0])return b.init.apply(a,c);if(b[c[0]]&&"_"!=c[0].toString().substr(0,1))return b[c[0]].apply(a,Array.prototype.slice.call(c,1));throw c[0]+" is an invalid value"};a.extend(a.fn,{flip:function(){return z(this,y,arguments)},turn:function(){return z(this,x,arguments)},transform:function(a,b){const c={};return b&&(c[d+"transform-origin"]=b),c[d+"transform"]=a,this.css(c)},animatef:function(a){const b=this.data();if(b.effect&&clearInterval(b.effect.handle),a){a.to.length||(a.to=[a.to]),a.from.length||(a.from=[a.from]),a.easing||(a.easing=function(a,d,e,b,c){return b*Math.sqrt(1-(d=d/c-1)*d)+e});let c;const d=[],e=a.to.length,g=this,h=a.fps||30;let i=-h;const j=function(){let c;const f=[];for(i=Math.min(a.duration,i+h),c=0;c<e;c++)f.push(a.easing(1,i,a.from[c],d[c],a.duration));a.frame(1==e?f[0]:f),i==a.duration&&(clearInterval(b.effect.handle),delete b.effect,g.data(b),a.complete&&a.complete())};for(c=0;c<e;c++)d.push(a.to[c]-a.from[c]);b.effect=a,b.effect.handle=setInterval(j,h),this.data(b),j()}else delete b.effect}}),a.isTouch=f})(jQuery);